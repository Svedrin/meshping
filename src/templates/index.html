<!DOCTYPE html>
<html>
  <head>
    <title>{{ Hostname }} &mdash; Meshping</title>
    <link rel="stylesheet"        href="/ui/node_modules/bootstrap/dist/css/bootstrap.min.css"></script>
    <script type="text/javascript" src="/ui/node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script type="text/javascript" src="/ui/node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="/ui/node_modules/vue/dist/vue.min.js"></script>
    <script type="text/javascript" src="/ui/node_modules/vue-resource/dist/vue-resource.min.js"></script>
    <script type="text/javascript">
      window.meshping_hostname = "{{ Hostname }}";
    </script>
  </head>
  <body>
    <div class="container mx-0 mx-lg-auto mt-md-3">
      <h1>Meshping: {{ Hostname }}</h1>
      {% raw %}
      <div id="app">
        <div class="btn-toolbar justify-content-between py-sm-3" role="toolbar" aria-label="Toolbar with button groups">
          <div class="btn-group" role="group" aria-label="Links">
            <a type="button" class="btn btn-light" href="/metrics">Metrics</a>
            <button type="button" class="btn btn-light" v-on:click="clear_stats">Clear statistics</button>
          </div>
          <div class="input-group">
            <div class="input-group-prepend">
              <div class="input-group-text" id="btnGroupSearch">Search</div>
            </div>
            <input type="text" v-model="search" id="inpsearch" class="form-control" placeholder="Name or IP" aria-label="Name or IP" aria-describedby="btnGroupSearch">
          </div>
        </div>
        <div class="alert alert-success" v-show="success_msg !== ''">
          <a href="#" class="close" aria-label="close" v-on:click="success_msg = ''">&times;</a>
          <span v-html="success_msg"></span>
        </div>
        <table class="table">
          <tr>
            <th>&nbsp;</th>
            <th>Target</th>
            <th>Address</th>
            <th class="text-right">Sent</th>
            <th class="text-right">Recv</th>
            <th class="text-right">Succ</th>
            <th class="text-right">Loss</th>
            <th class="text-right">Min</th>
            <th class="text-right">Avg15m</th>
            <th class="text-right">Avg6h</th>
            <th class="text-right">Avg24h</th>
            <th class="text-right">Max</th>
            <th class="text-right">Last</th>
            <th>&nbsp;</th>
          </tr>
          <tr v-if="targets_all.length == 0 &amp;&amp; last_update == 0">
            <td colspan="14"><span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading</td>
          </tr>
          <tr v-if="targets_all.length == 0 &amp;&amp; last_update != 0">
            <td colspan="14">No targets configured</td>
          </tr>
          <tr v-if="targets_filtered.length == 0 &amp;&amp; targets_all.length > 0">
            <td colspan="14">No targets match your search</td>
          </tr>
          <tr
            v-show="targets_filtered.length > 0" style="display: none"
            v-for="target in targets_filtered" v-bind:key="target.addr"
          >
            <td>
              <span v-if="target.state == 'up' &amp;&amp; target.avg15m &lt;= target.avg24h * 1.05" title="Target is up and well" class="text-success">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-check-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path fill-rule="evenodd" d="M10.97 4.97a.75.75 0 0 1 1.071 1.05l-3.992 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.236.236 0 0 1 .02-.022z"/>
                </svg>
              </span>
              <span v-if="target.state == 'up' &amp;&amp; target.avg15m &gt;  target.avg24h * 1.05" title="Target is up but latency is increasing" class="text-warning">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-arrow-up-right-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path fill-rule="evenodd" d="M5.172 10.828a.5.5 0 0 0 .707 0l4.096-4.096V9.5a.5.5 0 1 0 1 0V5.525a.5.5 0 0 0-.5-.5H6.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707z"/>
                </svg>
              </span>
              <span v-if="target.state == 'down'" title="Target is down" class="text-danger">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-x-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/>
                </svg>
              </span>
              <span v-if="target.state == 'unknown'" title="Target state is unknown" class="text-secondary">
                <svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-question-circle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path fill-rule="evenodd" d="M8 15A7 7 0 1 0 8 1a7 7 0 0 0 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                  <path d="M5.255 5.786a.237.237 0 0 0 .241.247h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286zm1.557 5.763c0 .533.425.927 1.01.927.609 0 1.028-.394 1.028-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94z"/>
                </svg>
              </span>
            </td>
            <td>{{ target.name }}</td>
            <td>{{ target.addr }}</td>
            <td class="text-right">{{ target.sent }}</td>
            <td class="text-right">{{ target.recv }}</td>
            <td class="text-right">{{ target.succ   | prettyFloat }}</td>
            <td class="text-right">{{ target.loss   | prettyFloat }}</td>
            <td class="text-right">{{ target.min    | prettyFloat }}</td>
            <td class="text-right">{{ target.avg15m | prettyFloat }}</td>
            <td class="text-right">{{ target.avg6h  | prettyFloat }}</td>
            <td class="text-right">{{ target.avg24h | prettyFloat }}</td>
            <td class="text-right">{{ target.max    | prettyFloat }}</td>
            <td class="text-right">{{ target.last   | prettyFloat }}</td>
            <td style="white-space: nowrap">
              <a v-bind:href="'/histogram/' + hostname + '/' + target.addr + '.png'" target="_blank">
                <img class="border" src="/ui/node_modules/bootstrap-icons/icons/graph-up.svg" alt="graph" title="Graph" />
              </a>
              <img class="border" src="/ui/node_modules/bootstrap-icons/icons/trash.svg" alt="del" title="Delete Target" v-on:click="delete_target(target)" />
            </td>
          </tr>
          <tr>
            <td colspan="3"><input type="text" class="form-control" v-model="add_tgt_name" placeholder="example.com" /></td>
            <td colspan="5"><input type="text" class="form-control" v-model="add_tgt_addr" placeholder="1.2.3.4 (optional)" /></td>
            <td><button class="form-control" v-on:click="create_target()">&plus;</button></td>
            <td colspan="5">&nbsp;</td>
          </tr>
        </table>
      </div>
      {% endraw %}
    </div>
    <script type="text/javascript" src="/ui/src/main.js"></script>
  </body>
</html>
